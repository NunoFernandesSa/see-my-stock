generator client {
  provider = "prisma-client"
}

datasource db {
  provider = "sqlite"
}

// Define an enum for movement types
enum MovementType {
  IN
  OUT
  ADJUSTMENT
}

model Organization {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  categories Category[]
  products   Product[]
  mouvements Mouvement[]
}

model Category {
  id          String   @id @default(cuid())
  name        String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  products       Product[]
}

model Product {
  id                String   @id @default(cuid())
  name              String
  description       String?
  purchasePrice     Decimal  @default(0)
  sellingPrice      Decimal  @default(0)
  currentStock      Int      @default(0)
  lowStockThreshold Int      @default(5)
  unit              String
  imageUrl          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  mouvements Mouvement[]
}

model Mouvement {
  id           String       @id @default(cuid())
  type         MovementType
  quantity     Int
  note         String?
  movementDate DateTime     @default(now())

  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@index([productId])
  @@index([organizationId])
  @@index([movementDate])
}
